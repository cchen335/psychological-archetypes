"use client";

import "@/lib/supabaseClient"
import { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { useRouter } from "next/navigation";

const archetypes = [
  "caregiver",
  "creator",
  "everyman",
  "explorer",
  "hero",
  "innocent",
  "lover",
  "magician",
  "mother",
  "philosopher",
  "rebirth",
  "ruler",
  "sage",
  "shadow",
  "trickster",
  "visionary",
];

export default function LandingPage() {
  const router = useRouter();
  const [showIntro, setShowIntro] = useState(true);
  const [flipped, setFlipped] = useState(false);

  const handleStart = () => {
    setShowIntro(false);
  };

  const handleFlip = async () => {
    setFlipped(true);
    // 等待动画结束再跳转
    setTimeout(() => {
      router.push("/questions");
    }, archetypes.length * 120 + 1200);
  };

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-black text-white px-6 py-12">
      <AnimatePresence mode="wait">
        {showIntro ? (
          // 介绍页面
          <motion.div
            key="intro"
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: -20 }}
            transition={{ duration: 0.6 }}
            className="max-w-2xl text-center space-y-8"
          >
            {/* 标题 */}
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.2, duration: 0.6 }}
            >
              <h1 className="text-4xl md:text-5xl font-light mb-4 tracking-wide">
                ArcheVoyage
              </h1>
              <p className="text-xl md:text-2xl text-white/80 font-light">
                A Journey into Your Psychological Archetypes
              </p>
            </motion.div>

            {/* 介绍文案 */}
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.4, duration: 0.6 }}
              className="space-y-6 text-white/70 leading-relaxed"
            >
              <p className="text-base md:text-lg">
                Drawing from Carl Jung's theory of archetypes, this assessment 
                reveals the powerful psychological patterns shaping your inner world.
              </p>
              
              <p className="text-base md:text-lg">
                Archetypes are universal symbols and behaviors residing in our 
                collective unconscious — they influence how we see ourselves, 
                relate to others, and navigate life's challenges.
              </p>

              <p className="text-base md:text-lg">
                Through {archetypes.length} carefully crafted dimensions, you'll discover 
                your dominant archetypes and gain insight into your psychological 
                narrative — the story you're living, often without realizing it.
              </p>
            </motion.div>

            {/* 测试信息 */}
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.6, duration: 0.6 }}
              className="pt-4 space-y-3 text-sm text-white/60"
            >
              <p>⏱️ Estimated time: 8-10 minutes</p>
              <p>📊 Questions: 40-50</p>
              <p>🎯 No right or wrong answers — just honest reflection</p>
            </motion.div>

            {/* 开始按钮 */}
            <motion.button
              initial={{ opacity: 0, scale: 0.9 }}
              animate={{ opacity: 1, scale: 1 }}
              transition={{ delay: 0.8, duration: 0.4 }}
              onClick={handleStart}
              className="mt-8 px-10 py-4 bg-white/10 hover:bg-white/20 rounded-full text-lg transition-all duration-300 hover:scale-105"
            >
              Begin Your Journey
            </motion.button>
          </motion.div>
        ) : (
          // 卡片翻转页面
          <motion.div
            key="cards"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ duration: 0.6 }}
            className="flex flex-col items-center"
          >
            <div className="grid grid-cols-4 md:grid-cols-8 gap-4 mb-12">
              {archetypes.map((name, i) => (
                <motion.div
                  key={name}
                  className="w-[140px] h-[200px] md:w-[160px] md:h-[230px] perspective-1000"
                  initial={false}
                  animate={{
                    rotateY: flipped ? 180 : 0,
                  }}
                  transition={{
                    duration: 0.8,
                    delay: i * 0.1,
                    ease: [0.65, 0, 0.35, 1],
                  }}
                  style={{
                    transformStyle: "preserve-3d",
                    position: "relative",
                  }}
                >
                  {/* Front */}
                  <motion.img
                    src={`/archetypes/${name}.webp`}
                    alt={name}
                    className="absolute w-full h-full object-cover rounded-lg shadow-lg backface-hidden"
                    style={{ backfaceVisibility: "hidden" }}
                  />
                  {/* Back */}
                  <motion.img
                    src={`/archetypes/back/${name}_back.webp`}
                    alt={`${name} back`}
                    className="absolute w-full h-full object-cover rounded-lg shadow-lg backface-hidden"
                    style={{
                      transform: "rotateY(180deg)",
                      backfaceVisibility: "hidden",
                    }}
                  />
                </motion.div>
              ))}
            </div>

            <div className="text-center space-y-4">
              <h2 className="text-2xl md:text-3xl font-light">
                Ready to discover your archetypes?
              </h2>
              <p className="text-white/70 text-lg">Click to reveal your journey</p>
              <button
                onClick={handleFlip}
                className="mt-4 px-8 py-3 bg-white/10 hover:bg-white/20 rounded-full text-lg transition-all duration-300 hover:scale-105"
              >
                Reveal
              </button>
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
}
